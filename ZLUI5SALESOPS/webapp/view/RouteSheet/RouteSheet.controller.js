sap.ui.controller("views.RouteSheet.RouteSheet",{approveDisapprove:function(e,t){var s=new sap.m.BusyDialog({text:e+" Route Sheet request. Please wait..."});s.open();var a=false;var o=this;var n=this.getView().getModel().getProperty("/tranDetail");var r=n.zrs_routesheet_detailsSet[0].Newunitprice;var i=n.zrs_routesheet_detailsSet[0].Newtlotprice;var l=n.zrs_routesheet_detailsSet[0].Newhouseprice;var p=n.zrs_routesheet_detailsSet[0].Newunitstatus;var u=this.getView().getModel().getProperty("/tranDetail/approverSet");var c=u;var d="";var R="/sap/bc/ui2/start_up";var h=null;h=new XMLHttpRequest;h.onreadystatechange=function(){if(h.readyState==4&&h.status==200){var e=JSON.parse(h.responseText);console.log(e);d=e.id}};h.open("GET",R,false);h.send(null);for(var S=0;S<c.length;S++){lastApprover=c[S].UserName}if(lastApprover===d){if(r==="0.00"||p===""){s.close();showActionMsg("ROUTESHEET-"+e.toUpperCase(),"ERROR3","Unable to "+e+" Route Sheet Request.\nPlease enter New Unit Status/Price.")}else{var f={Refnumber:n.RefNumber,NewStatus:n.zrs_routesheet_detailsSet[0].Newunitstatus,EvRefnumber:n.zrs_routesheet_headerSet[0].Newcontnumber,NewUnitPrice:r,NewValidFromDate:n.zrs_routesheet_detailsSet[0].NValidFrom,NewLotPrice:i,NewLotPriceValidFrom:n.zrs_routesheet_detailsSet[0].Nlvalidfrom,NewHousePrice:l,NewHousePriceValidFrom:n.zrs_routesheet_detailsSet[0].Nhvalidfrom,rsapprovalToCommentsSet:t};$.ajax({type:"GET",url:"/sap/opu/odata/sap/ZGW_RLC_SALES_SRV/approvalSet?$format=json",headers:{"X-CSRF-Token":"Fetch","X-Requested-With":"XMLHttpRequest"},async:true,contentType:"application/json",success:function(t,o,r){var i=r.getResponseHeader("X-CSRF-Token");$.ajax({type:"POST",url:"/sap/opu/odata/sap/ZGW_RLC_SALES_SRV/zrs_routesheet_actionSet",headers:{"X-CSRF-Token":i,"X-Requested-With":"JSONHttpRequest"},async:false,contentType:"application/json",dataType:"json",data:JSON.stringify(f),success:function(t,o,r){try{if(t.d.Type!="S"){s.close();showActionMsg("ROUTESHEET-"+e.toUpperCase(),"ERROR1",t.d.Message);return false}showActionMsg("ROUTESHEET-"+e.toUpperCase(),"SUCCESS","",n.RefNumber);sap.ui.getCore().byId(sessionCache["pageID"]+"oBtnApprove").setEnabled(false);sap.ui.getCore().byId(sessionCache["pageID"]+"oTAComments").setValue("");a=true;s.close()}catch(t){s.close();showActionMsg("ROUTESHEET-"+e.toUpperCase(),"ERROR2",t.message)}},error:function(t){s.close();showActionMsg("ROUTESHEET-"+e.toUpperCase(),"ERROR3","Unable to "+e+" Route Sheet Request.\nStatus Code: "+t.status+"\nStatus Text: "+t.statusText+"\nDescription: "+t.responseText)}})},error:function(){s.close();showActionMsg("ROUTESHEET-"+e.toUpperCase(),"ERROR4",e+" Route Sheet Request. Unable to fecth security token.")}});return a}}else{var f={Refnumber:n.RefNumber,NewStatus:n.zrs_routesheet_detailsSet[0].Newunitstatus,EvRefnumber:n.zrs_routesheet_headerSet[0].Newcontnumber,NewUnitPrice:r,NewLotPrice:i,NewLotPriceValidFrom:n.zrs_routesheet_detailsSet[0].Nlvalidfrom,NewHousePrice:l,NewHousePriceValidFrom:n.zrs_routesheet_detailsSet[0].Nhvalidfrom,NewValidFromDate:n.zrs_routesheet_detailsSet[0].NValidFrom,rsapprovalToCommentsSet:t};$.ajax({type:"GET",url:"/sap/opu/odata/sap/ZGW_RLC_SALES_SRV/approvalSet?$format=json",headers:{"X-CSRF-Token":"Fetch","X-Requested-With":"XMLHttpRequest"},async:true,contentType:"application/json",success:function(t,o,r){var i=r.getResponseHeader("X-CSRF-Token");$.ajax({type:"POST",url:"/sap/opu/odata/sap/ZGW_RLC_SALES_SRV/zrs_routesheet_actionSet",headers:{"X-CSRF-Token":i,"X-Requested-With":"JSONHttpRequest"},async:false,contentType:"application/json",dataType:"json",data:JSON.stringify(f),success:function(t,o,r){try{if(t.d.Type!="S"){s.close();showActionMsg("ROUTESHEET-"+e.toUpperCase(),"ERROR1",t.d.Message);return false}showActionMsg("ROUTESHEET-"+e.toUpperCase(),"SUCCESS","",n.RefNumber);sap.ui.getCore().byId(sessionCache["pageID"]+"oBtnApprove").setEnabled(false);sap.ui.getCore().byId(sessionCache["pageID"]+"oTAComments").setValue("");a=true;s.close()}catch(t){s.close();showActionMsg("ROUTESHEET-"+e.toUpperCase(),"ERROR2",t.message)}},error:function(t){s.close();showActionMsg("ROUTESHEET-"+e.toUpperCase(),"ERROR3","Unable to "+e+" Route Sheet Request.\nStatus Code: "+t.status+"\nStatus Text: "+t.statusText+"\nDescription: "+t.responseText)}})},error:function(){s.close();showActionMsg("ROUTESHEET-"+e.toUpperCase(),"ERROR4",e+" Route Sheet Request. Unable to fecth security token.")}});return a}},doneUpload:function(e,t,s,a,o){var n=this.getView().getModel().getProperty("/tranDetail/newAttach");if(n!=undefined){if(n.fileName!=""){this.uploadAttachment(n,e);var r={Refnumber:"",Attachtype:"",Filecategory:"",Filelocation:"",Filename:"",PhysLocation:"SHAREPT",Url:"",file:"",enable:false};this.getView().getModel().setProperty("/tranDetail/newAttach",r)}}t.setUploadUrl("");t.clear();a.closeSection(o);a.openSection(o)},fileUpload1:function(e,t,s){var a={Refnumber:this.getView().getModel().getProperty("/tranDetail/RefNumber"),Attachtype:"A",Filecategory:"RES_ROUTESHEET",Filelocation:"",Filename:e.name.replace(/,/gi,""),PhysLocation:"SHAREPT",Url:"",file:e,enable:true};this.getView().getModel().setProperty("/tranDetail/newAttach",a)},uploadAttachment:function(e,t){var s=this;var a=false;var o=undefined;var n=this.getView().getModel().getProperty("/tranDetail/newAttach");var r=this.getView().getModel().getProperty("/tranDetail/Attachments");var i=this.getView().getModel().getProperty("/tranDetail");var l=n.file;o=i.RefNumber+";RES_ROUTESHEET;RES_ROUTESHEET;"+l.name.replace(/,/gi,"");var p=l.name.replace(/,/gi,"");var u=l.type;if(u==""){if(l.name.split(".")[1]=="docx"){u="application/vnd.openxmlformats-officedocument.wordprocessingml.document"}else if(l.name.split(".")[1]=="doc"){u="application/msword"}else if(l.name.split(".")[1]=="xlsx"){u="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}else if(l.name.split(".")[1]=="xls"){u="application/vnd.ms-excel"}else if(l.name.split(".")[1]=="pptx"){u="application/vnd.openxmlformats-officedocument.presentationml.presentation"}else if(l.name.split(".")[1]=="ppt"){u="application/vnd.ms-powerpoint"}else if(l.name.split(".")[1]=="image/png"){u="image/png"}}$.ajax({type:"GET",url:"/sap/opu/odata/sap/ZGW_RLC_SALES_SRV/FileAttachmentSet?$format=json",headers:{"X-CSRF-Token":"Fetch","X-Requested-With":"XMLHttpRequest"},async:false,contentType:"application/json",success:function(n,i,p){var c=p.getResponseHeader("X-CSRF-Token");var d={"X-CSRF-Token":c,"X-Requested-With":"XMLHttpRequest",slug:o,Accept:"application/json"};jQuery.ajax({type:"POST",url:"/sap/opu/odata/sap/ZGW_RLC_SALES_SRV/FileAttachmentSet",cache:false,headers:d,cache:false,contentType:u,processData:false,async:false,data:l,success:function(o){if(r==undefined){r=[]}e.Url=o.d.URL;r.push(e);s.getView().getModel().setProperty("/tranDetail/Attachments",r);t.setVisibleRowCount(r.length);t.setVisible(true);s.showMsg("Upload Documents","Uploading of document successful!","SUCCESS");a=true},error:function(e){s.showMsg("Upload Documents","Error uploading supporting documents.\nStatus Code: "+e.status+"\nStatus Text: "+e.statusText+"\nDescription: "+e.responseText,"ERROR");a=false}})},error:function(e){s.showMsg("Upload Documents","Error getting security token.\nStatus Code: "+e.status+"\nStatus Text: "+e.statusText+"\nDescription: "+e.responseText,"ERROR");a=false}})},delAttachment:function(){jQuery(".mvn-dp-busyIndicator").css("display","block");var e=false;_this=this;var t=this.getView().getModel().getProperty("/tranDetail/DeletedAttachments");$.ajax({type:"GET",url:"/sap/opu/odata/sap/ZGW_RLC_SALES_SRV/FileAttachmentSet?$format=json",headers:{"X-CSRF-Token":"Fetch","X-Requested-With":"XMLHttpRequest"},async:false,contentType:"application/json",success:function(s,a,o){var n=o.getResponseHeader("X-CSRF-Token");jQuery.ajax({type:"DELETE",url:"/sap/opu/odata/sap/ZGW_RLC_SALES_SRV/FileAttachmentSet(Filename='"+t[0].Filename+"',Refnumber='"+t[0].Refnumber+"',Application='RES_ROUTESHEET')/$value",headers:{"X-CSRF-Token":n,"X-Requested-With":"JSONHttpRequest"},async:false,success:function(t){_this.getView().getModel().setProperty("/tranDetail/DeletedAttachments",[]);e=true},error:function(t){_this.showMsg("Delete Documents","Error deleting supporting documents.\nStatus Code: "+t.status+"\nStatus Text: "+t.statusText+"\nDescription: "+t.responseText,"ERROR");e=false}})},error:function(t){_this.showMsg("Delete Documents","Error getting security token.\nStatus Code: "+t.status+"\nStatus Text: "+t.statusText+"\nDescription: "+t.responseText,"ERROR");e=false}});return e},delAttachment1:function(e,t,s){var a=this;var o=false;var n=this.getView().getModel().getProperty("/tranDetail/Attachments");var r=this.getView().getModel().getProperty("/tranDetail/DeletedAttachments");if(r==undefined)r=[];r.push(n[e]);this.getView().getModel().setProperty("/tranDetail/DeletedAttachments",r);o=a.delAttachment(e);if(o){delete n[e];n.splice(e,1);this.getView().getModel().getProperty("/tranDetail/Attachments",n);if(n.length==0){t.setVisible(false)}else{t.setVisibleRowCount(n.length)}t.bindRows("/tranDetail/Attachments");if(s.getCollapsed()==false){s.setCollapsed(true);s.setCollapsed(false)}}},showMsg:function(e,t,s){jQuery.sap.require("sap.m.MessageBox");sap.m.MessageBox.show(t,{icon:s=="ERROR"?sap.m.MessageBox.Icon.ERROR:sap.m.MessageBox.Icon.SUCCESS,title:e,actions:[sap.m.MessageBox.Action.OK]})},validateNewUnitStatus:function(){var e=sap.ui.getCore().byId("iNewUnitStatus");if(e.getValue()===""){alert("Please enter New Unit Status.")}},validateNewUnitPrice:function(){var e=sap.ui.getCore().byId("iNewUnitPrice");if(e.getValue()===""){alert("Please enter New Unit Price.")}}});
//# sourceMappingURL=RouteSheet.controller.js.map