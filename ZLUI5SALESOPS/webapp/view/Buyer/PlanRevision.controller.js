sap.ui.controller("views.Buyer.PlanRevision",{approveDisapprove:function(e,t){var s=new sap.m.BusyDialog({text:e+" Plan Revision request. Please wait..."});s.open();var a=false;var n=this;var o=this.getView().getModel().getProperty("/tranDetail");try{o.PV_PlanRevSet[0].CostPmd=o.PV_PlanRevSet[0].CostPmd.replace(/,/g,"");o.PV_PlanRevSet[0].CostDpd=o.PV_PlanRevSet[0].CostDpd.replace(/,/g,"");o.PV_PlanRevSet[0].CostBdd=o.PV_PlanRevSet[0].CostBdd.replace(/,/g,"")}catch(e){}var i={action:e.toUpperCase(),RequestNumber:o.Refnumber,approvalToCommentsSet:t,approvalToPlanRevSet:[{Refnumber:o.Refnumber,ExpiryDate:o.PV_PlanRevSet[0].ExpiryDate,CostPmd:o.PV_PlanRevSet[0].CostPmd,CostDpd:o.PV_PlanRevSet[0].CostDpd,CostBdd:o.PV_PlanRevSet[0].CostBdd,PmdDate:o.PV_PlanRevSet[0].PmdDate,DpdDate:o.PV_PlanRevSet[0].DpdDate,BddDate:o.PV_PlanRevSet[0].BddDate}]};$.ajax({type:"GET",url:"/sap/opu/odata/sap/ZGW_RLC_SALES_SRV/approvalSet?$format=json",headers:{"X-CSRF-Token":"Fetch","X-Requested-With":"XMLHttpRequest"},async:true,contentType:"application/json",success:function(t,n,r){var l=r.getResponseHeader("X-CSRF-Token");$.ajax({type:"POST",url:"/sap/opu/odata/sap/ZGW_RLC_SALES_SRV/approvalSet",headers:{"X-CSRF-Token":l,"X-Requested-With":"JSONHttpRequest"},async:false,contentType:"application/json",dataType:"json",data:JSON.stringify(i),success:function(t,n,i){try{if(t.d.Type!="S"){s.close();showActionMsg("PLANREV-"+e.toUpperCase(),"ERROR",t.d.Message);return false}showActionMsg("PLANREV-"+e.toUpperCase(),"SUCCESS","",o.Refnumber);sap.ui.getCore().byId(sessionCache["pageID"]+"oBtnApprove").setEnabled(false);sap.ui.getCore().byId(sessionCache["pageID"]+"oBtnDisapprove").setEnabled(false);sap.ui.getCore().byId(sessionCache["pageID"]+"oTAComments").setValue("");a=true;s.close()}catch(t){s.close();showActionMsg("PLANREV-"+e.toUpperCase(),"ERROR",t.message)}},error:function(t){s.close();showActionMsg("PLANREV-"+e.toUpperCase(),"ERROR","Unable to "+e+" Plan Revision Request.\nStatus Code: "+t.status+"\nStatus Text: "+t.statusText+"\nDescription: "+t.responseText)}})},error:function(){s.close();showActionMsg("PLANREV-"+e.toUpperCase(),"ERROR",e+" Plan Revision Request. Unable to fecth security token.")}});return a},doneUpload:function(e,t,s,a,n){var o=this.getView().getModel().getProperty("/tranDetail/newAttach");var i=this.getView().getModel().getProperty("/tranDetail/Attachments");if(o!=undefined){if(o.fileName!=""){if(i==undefined){i=[]}i.push(o);this.uploadAttachment();this.getView().getModel().setProperty("/tranDetail/Attachments",i);e.setVisibleRowCount(i.length);e.setVisible(true);var r={Refnumber:"",Attachtype:"",Filecategory:"",Filelocation:"",Filename:"",PhysLocation:"SHAREPT",Url:"",file:"",enable:false};this.getView().getModel().setProperty("/tranDetail/newAttach",r)}}t.setUploadUrl("");t.clear();a.closeSection(n);a.openSection(n)},fileUpload1:function(e,t,s){var a={Refnumber:this.getView().getModel().getProperty("/tranDetail/Refnumber"),Attachtype:"A",Filecategory:this.getView().getModel().getProperty("/tranDetail/AddDocType"),Filelocation:"",Filename:e.name.replace(/,/gi,""),PhysLocation:"SHAREPT",Url:"http://jgsmlaspsd001:9130/sites/AppDevPortal/Shared Documents1/RE_SALES/BUYERS_CORNER/0000001525/BUYERDOC/NOTES ON LTO.TXT",file:e,enable:true};this.getView().getModel().setProperty("/tranDetail/newAttach",a)},uploadAttachment:function(){var e=this;var t=false;var s=undefined;var a=this.getView().getModel().getProperty("/tranDetail/newAttach");var n=this.getView().getModel().getProperty("/tranDetail");var o=a.file;s=n.Refnumber+";RES_PLANREV;"+n.AddDocType+";"+o.name.replace(/,/gi,"");var i=o.name.replace(/,/gi,"");var r=o.type;if(r==""){if(o.name.split(".")[1]=="docx"){r="application/vnd.openxmlformats-officedocument.wordprocessingml.document"}else if(o.name.split(".")[1]=="doc"){r="application/msword"}else if(o.name.split(".")[1]=="xlsx"){r="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}else if(o.name.split(".")[1]=="xls"){r="application/vnd.ms-excel"}else if(o.name.split(".")[1]=="pptx"){r="application/vnd.openxmlformats-officedocument.presentationml.presentation"}else if(o.name.split(".")[1]=="ppt"){r="application/vnd.ms-powerpoint"}else if(o.name.split(".")[1]=="image/png"){r="image/png"}}$.ajax({type:"GET",url:"/sap/opu/odata/sap/ZGW_RLC_SALES_SRV/FileAttachmentSet?$format=json",headers:{"X-CSRF-Token":"Fetch","X-Requested-With":"XMLHttpRequest"},async:false,contentType:"application/json",success:function(a,n,i){var l=i.getResponseHeader("X-CSRF-Token");var p={"X-CSRF-Token":l,"X-Requested-With":"XMLHttpRequest",slug:s,Accept:"application/json"};jQuery.ajax({type:"POST",url:"/sap/opu/odata/sap/ZGW_RLC_SALES_SRV/FileAttachmentSet",cache:false,headers:p,cache:false,contentType:r,processData:false,async:false,data:o,success:function(s){e.showMsg("Upload Documents","Uploading of document successful!","SUCCESS");t=true},error:function(s){e.showMsg("Upload Documents","Error uploading supporting documents.\nStatus Code: "+s.status+"\nStatus Text: "+s.statusText+"\nDescription: "+s.responseText,"ERROR");t=false}})},error:function(s){e.showMsg("Upload Documents","Error getting security token.\nStatus Code: "+s.status+"\nStatus Text: "+s.statusText+"\nDescription: "+s.responseText,"ERROR");t=false}})},delAttachment:function(e){jQuery(".mvn-dp-busyIndicator").css("display","block");var t=false;_this=this;var s=this.getView().getModel().getProperty("/tranDetail/DeletedAttachments");$.ajax({type:"GET",url:"/sap/opu/odata/sap/ZGW_RLC_SALES_SRV/FileAttachmentSet?$format=json",headers:{"X-CSRF-Token":"Fetch","X-Requested-With":"XMLHttpRequest"},async:false,contentType:"application/json",success:function(e,a,n){var o=n.getResponseHeader("X-CSRF-Token");jQuery.ajax({type:"DELETE",url:"/sap/opu/odata/sap/ZGW_RLC_SALES_SRV/FileAttachmentSet(Filename='"+s[0].Filename+"',Refnumber='"+s[0].Refnumber+"',Application='RES_PLANREV')/$value",headers:{"X-CSRF-Token":o,"X-Requested-With":"JSONHttpRequest"},async:false,success:function(e){_this.getView().getModel().setProperty("/tranDetail/DeletedAttachments",s);t=true},error:function(e){_this.showMsg("Delete Documents","Error deleting supporting documents.\nStatus Code: "+e.status+"\nStatus Text: "+e.statusText+"\nDescription: "+e.responseText,"ERROR");t=false}})},error:function(e){_this.showMsg("Delete Documents","Error getting security token.\nStatus Code: "+e.status+"\nStatus Text: "+e.statusText+"\nDescription: "+e.responseText,"ERROR");t=false}});return t},delAttachment1:function(e,t,s){var a=this;var n=false;var o=this.getView().getModel().getProperty("/tranDetail/Attachments");var i=this.getView().getModel().getProperty("/tranDetail/DeletedAttachments");if(i==undefined)i=[];i.push(o[e]);this.getView().getModel().setProperty("/tranDetail/DeletedAttachments",i);n=a.delAttachment(e);if(n){delete o[e];o.splice(e,1);this.getView().getModel().getProperty("/tranDetail/Attachments",o);if(o.length==0){t.setVisible(false)}else{t.setVisibleRowCount(o.length)}t.bindRows("/tranDetail/Attachments");if(s.getCollapsed()==false){s.setCollapsed(true);s.setCollapsed(false)}}},showMsg:function(e,t,s){jQuery.sap.require("sap.m.MessageBox");sap.m.MessageBox.show(t,{icon:s=="ERROR"?sap.m.MessageBox.Icon.ERROR:sap.m.MessageBox.Icon.SUCCESS,title:e,actions:[sap.m.MessageBox.Action.OK]})}});
//# sourceMappingURL=PlanRevision.controller.js.map